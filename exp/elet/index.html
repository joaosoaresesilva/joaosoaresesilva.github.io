<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>ANALO. CIRCUITO</title>
    <style>
        body { font-family: 'Courier New', Courier, monospace; background: #fff; color: #000; padding: 20px; font-size: 12px; }
        h3 { text-transform: uppercase; border-bottom: 2px solid #000; margin-bottom: 5px; }
        
        /* Layout */
        .grid-main { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        
        /* Mapa Superior */
        #map-canvas { 
            width: 900px; height: 350px; border: 2px solid #000; position: relative;
            background: #e3e3e3; /* RepresentaÃ§Ã£o de mapa base */
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .gps-marker { position: absolute; font-size: 20px; display: none; transform: translate(-50%, -100%); z-index: 10; }
        .map-label { position: absolute; font-size: 9px; color: #666; font-weight: bold; }

        /* Painel Inferior (SimulaÃ§Ã£o) */
        .simulation-area { 
            width: 900px; transform: scale(0.9); transform-origin: top;
            border-top: 1px dashed #000; padding-top: 20px;
        }

        .sar-map { width: 100%; height: 250px; border: 1px solid #000; position: relative; background: #f0f0f0; }
        .river-line { position: absolute; background: #bbb; border: 1px solid #000; top: 110px; left: 0; width: 100%; height: 12px; }

        .control-panel { border: 2px solid #000; padding: 15px; background: #f0f0f0; margin-bottom: 15px; display: flex; gap: 40px; }
        .health-bar { height: 6px; border: 1px solid #000; background: #fff; margin-top: 2px; }
        .health-fill { height: 100%; background: #000; width: 100%; transition: 0.2s; }

        .flood-area { position: absolute; background: repeating-linear-gradient(45deg, #ddd, #ddd 5px, #eee 5px, #eee 10px); display: none; border: 1px solid #999; }
        .log { width: 880px; height: 100px; border: 1px solid #000; margin-top: 10px; overflow-y: scroll; padding: 10px; font-size: 10px; }
        
        input[type="range"] { cursor: pointer; }
        button { background: #000; color: #fff; border: none; padding: 5px 10px; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="grid-main">
        <div id="map-canvas">
            <div style="padding: 10px; font-weight: bold;">[ VISUALIZAÃ‡ÃƒO MAPA]</div>
            
            <div class="map-label" style="top: 10px; left: 10px;">LAT: 40.2111 (COIMBRA)</div>
            <div class="map-label" style="bottom: 10px; right: 10px;">LAT: 40.1501 (FIGUEIRA FOZ)</div>

            <svg width="900" height="350" style="position:absolute; top:0; left:0;">
                <path d="M50,150 Q200,140 300,180 T600,200 T850,220" fill="none" stroke="#999" stroke-width="8" />
                <path id="map-river-active" d="M50,150 Q200,140 300,180 T600,200 T850,220" fill="none" stroke="#000" stroke-width="2" stroke-dasharray="5,5" />
            </svg>

            <div id="gps-1" class="gps-marker" style="top:165px; left:220px;">ðŸš¨<br><small>FORMOSHELHA</small></div>
            <div id="gps-2" class="gps-marker" style="top:195px; left:410px;">ðŸš¨<br><small>MONTEMOR</small></div>
            <div id="gps-3" class="gps-marker" style="top:205px; left:580px;">ðŸš¨<br><small>BIVALTAS</small></div>
            <div id="gps-4" class="gps-marker" style="top:215px; left:750px;">ðŸš¨<br><small>MAIORCA</small></div>
        </div>

        <div class="simulation-area">
            <div class="control-panel">
                <div>
                    <b>CAUDAL AGUIEIRA:</b> <span id="v-caudal">50</span> mÂ³/s<br>
                    <input type="range" id="range-caudal" min="0" max="3500" value="50">
                </div>
                <div>
                    <b>MARÃ‰ (FIGUEIRA):</b> <span id="v-mare">0.0</span> m<br>
                    <input type="radio" name="m" id="m-auto" checked> AUTO
                    <input type="radio" name="m" id="m-man"> MAN
                    <input type="range" id="range-mare" min="-100" max="400" value="0">
                </div>
                <button onclick="writeLog('SINCRONIZAÃ‡ÃƒO INICIADA...')">Sync APA </button>
            </div>

            <div class="sar-map">
                <div id="river-sim" class="river-line"></div>
                
                <div style="position:absolute; left:180px; top:70px; width:80px;">
                    FORMOSHELHA<br><div class="health-bar"><div id="hb1" class="health-fill"></div></div>
                </div>
                <div style="position:absolute; left:380px; top:135px; width:80px;">
                    MONTEMOR<br><div class="health-bar"><div id="hb2" class="health-fill"></div></div>
                </div>
                <div style="position:absolute; left:560px; top:70px; width:80px;">
                    BIVALTAS<br><div class="health-bar"><div id="hb3" class="health-fill"></div></div>
                </div>
                <div style="position:absolute; left:740px; top:135px; width:80px;">
                    MAIORCA<br><div class="health-bar"><div id="hb4" class="health-fill"></div></div>
                </div>

                <div id="fa1" class="flood-area" style="top:125px; left:170px; width:100px; height:60px;"></div>
                <div id="fa2" class="flood-area" style="top:40px; left:370px; width:120px; height:70px;"></div>
                <div id="fa3" class="flood-area" style="top:125px; left:550px; width:110px; height:80px;"></div>
                <div id="fa4" class="flood-area" style="top:30px; left:730px; width:130px; height:100px;"></div>
            </div>

            <div class="log" id="log-box">> AGUARDANDO DADOS DE FLUXO...</div>
        </div>
    </div>

    <script>
        let time = 0;
        let zones = [
            { id: 1, name: "FORMOSHELHA", health: 100, threshold: 1250, factor: 0.007, broken: false },
            { id: 2, name: "MONTEMOR", health: 100, threshold: 1600, factor: 0.010, broken: false },
            { id: 3, name: "BIVALTAS", health: 100, threshold: 1400, factor: 0.008, broken: false },
            { id: 4, name: "MAIORCA", health: 100, threshold: 1100, factor: 0.016, broken: false }
        ];

        function writeLog(m) {
            const l = document.getElementById('log-box');
            l.innerHTML = `> ${new Date().toLocaleTimeString()}: ${m}<br>` + l.innerHTML;
        }

        function engine() {
            time += 0.02;
            const caudal = parseInt(document.getElementById('range-caudal').value);
            const isAuto = document.getElementById('m-auto').checked;
            const mare = isAuto ? Math.sin(time) * 2.2 : parseInt(document.getElementById('range-mare').value) / 100;
            
            document.getElementById('v-caudal').innerText = caudal;
            document.getElementById('v-mare').innerText = mare.toFixed(2);

            zones.forEach(z => {
                const stress = caudal + (mare * (z.id * 15));
                if (stress > z.threshold && !z.broken) {
                    z.health -= (stress - z.threshold) * z.factor / 100;
                } else if (z.health < 100 && !z.broken) {
                    z.health += 0.01;
                }

                if (z.health <= 0 && !z.broken) {
                    z.broken = true;
                    z.health = 0;
                    document.getElementById(`gps-${z.id}`).style.display = "block";
                    document.getElementById(`fa-${z.id}`) ? "" : document.getElementById(`fa${z.id}`).style.display = "block";
                    writeLog(`FALHA GPS DETETADA EM ${z.name}. COORDENADAS ALERTADAS.`, "#000");
                }

                document.getElementById(`hb${z.id}`).style.width = z.health + "%";
            });

            // Efeito visual no rio simulado
            const b = Math.min(220, 100 + (caudal / 15));
            document.getElementById('river-sim').style.backgroundColor = `rgb(${b},${b},${b})`;
            
            requestAnimationFrame(engine);
        }

        engine();
    </script>
</body>
</html>