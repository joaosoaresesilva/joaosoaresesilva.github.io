<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Análise de Pressão: Monda-i </title>
    <style>
        body { font-family: 'Courier New', monospace; background: #fff; color: #000; padding: 20px; }
        .dashboard { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        
        /* Controlos */
        .controls { border: 2px solid #000; padding: 15px; background: #f9f9f9; }
        .control-group { margin-bottom: 20px; }
        input[type="range"] { width: 100%; }

        /* Gráfico */
        .chart-container { position: relative; height: 400px; border-left: 2px solid #000; border-bottom: 2px solid #000; margin-left: 40px; }
        .y-axis-label { position: absolute; transform: rotate(-90deg); left: -60px; top: 50%; font-weight: bold; }
        .x-axis-label { text-align: center; margin-top: 10px; font-weight: bold; }
        
        .pressure-line { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; }
        .zone-point { 
            position: absolute; width: 12px; height: 12px; background: #fff; 
            border: 2px solid #000; border-radius: 50%; transform: translate(-50%, 50%);
            transition: bottom 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .zone-tag { position: absolute; font-size: 10px; transform: rotate(-45deg); white-space: nowrap; top: 15px; }
        .threshold-line { position: absolute; width: 100%; border-top: 1px dashed red; z-index: 0; }
        
        .status-box { margin-top: 20px; padding: 10px; border: 1px solid #000; font-size: 12px; }
        button { background: #000; color: #fff; border: none; padding: 10px; cursor: pointer; width: 100%; font-family: 'Courier New'; }
        .active-alivio { background: #d00 !important; }
    </style>
</head>
<body>

    <h2>PRESSÃO: BAIXO MONDEGO</h2>

    <div class="dashboard">
        <div class="controls">
            <div class="control-group">
                <label><b>CAUDAL AGUI.ª-i (DC)</b></label><br>
                <input type="range" id="q-in" min="0" max="4000" value="500">
                <span id="val-q">500</span> m³/s
            </div>

            <div class="control-group">
                <label><b>MARÉ FIGU.ª-i (AC)</b></label><br>
                <input type="range" id="m-in" min="-100" max="450" value="0">
                <span id="val-m">0.0</span> m
            </div>

            <div class="control-group">
                <label><b>ESTRAT. OBSER.
                <button id="btn-alivio" onclick="toggleAlivio()">ABRIR DIQUE </button>
            </div>

            <div class="status-box" id="status">
                STATUS: SISTEMA ESTÁVEL
            </div>
            <br>
            <button onclick="resetSystem()" style="background: #666;">RESET</button>
        </div>

        <div class="chart-area">
            <div class="chart-container" id="chart">
                <div class="y-axis-label">PRESSÃO (kPa / COTA)</div>
                <div class="threshold-line" style="bottom: 75%;"> <small style="color:red; background:#fff;">RUTURA DIQUE</small></div>
                
                <svg id="svg-line" width="100%" height="100%" style="position:absolute; bottom:0; overflow:visible;">
                    <path id="path-line" d="" fill="none" stroke="black" stroke-width="2" />
                </svg>

                <div id="z-coimbra" class="zone-point" style="left: 0%;"><span class="zone-tag">Coimbra</span></div>
                <div id="z-casais" class="zone-point" style="left: 20%;"><span class="zone-tag">P. Casais</span></div>
                <div id="z-formos" class="zone-point" style="left: 35%;"><span class="zone-tag">Formoselha</span></div>
                <div id="z-montemor" class="zone-point" style="left: 55%;"><span class="zone-tag">Montemor</span></div>
                <div id="z-bivaltas" class="zone-point" style="left: 75%;"><span class="zone-tag">Bivaltas</span></div>
                <div id="z-maiorca" class="zone-point" style="left: 90%;"><span class="zone-tag">Maiorca</span></div>
                <div id="z-foz" class="zone-point" style="left: 100%;"><span class="zone-tag">Fig. Foz</span></div>
            </div>
            <div class="x-axis-label">DISTÂNCIA LONGITUDINAL (COIMBRA → FOZ)</div>
        </div>
    </div>

    <script>
        let alivioAtivo = false;
        const zones = [
            { id: 'z-coimbra', x: 0, k: 1.0, d: 0.05 },
            { id: 'z-casais', x: 20, k: 1.2, d: 0.1 },
            { id: 'z-formos', x: 35, k: 1.6, d: 0.2 },
            { id: 'z-montemor', x: 55, k: 1.4, d: 0.4 },
            { id: 'z-bivaltas', x: 75, k: 1.3, d: 0.7 },
            { id: 'z-maiorca', x: 90, k: 1.2, d: 1.2 },
            { id: 'z-foz', x: 100, k: 1.0, d: 1.5 }
        ];

        function toggleAlivio() {
            alivioAtivo = !alivioAtivo;
            document.getElementById('btn-alivio').classList.toggle('active-alivio');
            document.getElementById('btn-alivio').innerText = alivioAtivo ? "ALÍVIO ATIVO" : "ABRIR DIQUE EMERG.";
            update();
        }

        function resetSystem() {
            alivioAtivo = false;
            document.getElementById('btn-alivio').classList.remove('active-alivio');
            document.getElementById('q-in').value = 500;
            document.getElementById('m-in').value = 0;
            update();
        }

        function update() {
            const Q = parseInt(document.getElementById('q-in').value);
            const M = parseInt(document.getElementById('m-in').value) / 100;
            const beta = alivioAtivo ? 0.65 : 1.0;

            document.getElementById('val-q').innerText = Q;
            document.getElementById('val-m').innerText = M.toFixed(2);

            let pathData = "";
            let maxPressure = 0;

            zones.forEach((z, i) => {
                // Cálculo da Pressão na Zona
                // O impacto do caudal diminui ligeiramente com a distância, 
                // mas a maré aumenta exponencialmente perto da foz.
                let qEffect = (Q / 40) * z.k;
                if (alivioAtivo && z.x > 20) qEffect *= beta; // Alívio afeta tudo a distabcia jusante dique aberto 

                let mEffect = (M * 20) * z.d;
                let pressure = qEffect + mEffect;
                
                // Limitar para o gráfico (0 a 100%)
                let visualY = Math.min(100, pressure);
                document.getElementById(z.id).style.bottom = visualY + "%";

                // Gerar linha do gráfico
                let chartW = document.getElementById('chart').offsetWidth;
                let chartH = document.getElementById('chart').offsetHeight;
                let px = (z.x / 100) * chartW;
                let py = chartH - (visualY / 100 * chartH);
                pathData += (i === 0 ? "M" : "L") + px + "," + py;

                if (visualY > 75) {
                    document.getElementById(z.id).style.backgroundColor = "red";
                    maxPressure = Math.max(maxPressure, visualY);
                } else {
                    document.getElementById(z.id).style.backgroundColor = "#fff";
                }
            });

            document.getElementById('path-line').setAttribute("d", pathData);
            
            const status = document.getElementById('status');
            if (maxPressure > 75) {
                status.innerText = "ALERTA: RUTURA IMINENTE NAS ZONAS VERMELHAS";
                status.style.color = "red";
            } else {
                status.innerText = "STATUS: SISTEMA ESTÁVEL";
                status.style.color = "black";
            }
        }

        document.getElementById('q-in').addEventListener('input', update);
        document.getElementById('m-in').addEventListener('input', update);
        window.addEventListener('resize', update);
        update();
    </script>
</body>
</html>
