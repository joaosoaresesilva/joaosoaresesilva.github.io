<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>MONDEGO MONITOR - COIMBRA SCATTERPLOT</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; background: #050505; color: #d0d2d6; font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #map { height: 48vh; width: 100%; filter: contrast(1.2) brightness(0.8); border-bottom: 2px solid #0044ff; }
        .sar-header { background: #111; padding: 10px 20px; font-size: 11px; color: #00d2ff; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .data-layout { flex: 1; display: flex; overflow: hidden; }
        .sidebar { width: 300px; padding: 15px; border-right: 1px solid #222; background: #0a0a0a; display: flex; flex-direction: column; }
        .table-container { flex: 1; overflow-y: auto; padding: 10px; font-size: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #00d2ff; border-bottom: 2px solid #333; padding: 8px; position: sticky; top: 0; background: #0a0a0a; }
        td { padding: 6px; border-bottom: 1px solid #1a1a1a; }
        .status-badge { padding: 2px 5px; border-radius: 3px; font-weight: bold; font-size: 8px; text-transform: uppercase; }
        .c-ref { color: #00ff77; border: 1px solid #00ff77; }
        .c-sat { color: #00d2ff; border: 1px solid #00d2ff; }
        .c-flo { color: #4488ff; border: 1px solid #0044ff; }
        .id-urban { color: #fff; font-weight: bold; }
    </style>
</head>
<body>

<div class="sar-header">
    <div><b>MONDEGO EMSR864</b> | FOCO: COIMBRA & BAIXO MONDEGO</div>
    <div id="counter">PONTOS CARREGADOS: 0</div>
</div>

<div id="map"></div>

<div class="data-layout">
    <div class="sidebar">
        <h3 style="margin-top:0; font-size: 14px; color: #0044ff;">SETOR: COIMBRA (URBANO)</h3>
        <p style="font-size: 11px; opacity: 0.8;">Mapeamento discreto de IDs sobre as zonas de risco de Coimbra e extensão do vale.</p>
        <div style="font-size: 10px; line-height: 1.6;">
            <span style="color:#00ff77">●</span> REF: Água de Referência<br>
            <span style="color:#00d2ff">●</span> SAT: Saturação Urbana<br>
            <span style="color:#0044ff">●</span> FLO: Inundação Confirmada
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr><th>ID SCATTER</th><th>LOCALIZAÇÃO</th><th>CLASSE SAR</th></tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', {zoomControl: false}).setView([40.2050, -8.4350], 14);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const scatterDataset = [];

    function generateData() {
        const setores = [
            // COIMBRA - ZONA URBANA (Alta Densidade)
            { prefix: "COI-REF", label: "Referência", color: "#00ff77", style: "c-ref", count: 40, lat: [40.201, 40.212], lng: [-8.438, -8.430] },
            { prefix: "COI-SAT", label: "Saturação", color: "#00d2ff", style: "c-sat", count: 60, lat: [40.203, 40.210], lng: [-8.436, -8.432] },
            { prefix: "COI-FLO", label: "Inundação", color: "#0044ff", style: "c-flo", count: 30, lat: [40.202, 40.208], lng: [-8.435, -8.433] },
            // BAIXO MONDEGO - EXTENSÃO (Média Densidade)
            { prefix: "BM-SAT", label: "Saturação", color: "#00d2ff", style: "c-sat", count: 80, lat: [40.14, 40.19], lng: [-8.80, -8.50] },
            { prefix: "BM-FLO", label: "Inundação", color: "#0044ff", style: "c-flo", count: 100, lat: [40.13, 40.18], lng: [-8.84, -8.55] }
        ];

        setores.forEach(s => {
            for (let i = 0; i < s.count; i++) {
                const lat = s.lat[0] + Math.random() * (s.lat[1] - s.lat[0]);
                const lng = s.lng[0] + Math.random() * (s.lng[1] - s.lng[0]);
                const id = `${s.prefix}-${1000 + i}`;

                const entry = { id: id, lat: lat, lng: lng, label: s.label, style: s.style, color: s.color };
                scatterDataset.push(entry);

                L.circleMarker([lat, lng], {
                    radius: 3,
                    fillColor: s.color,
                    color: "#fff",
                    weight: 0.5,
                    fillOpacity: 0.8
                }).addTo(map).bindPopup(`<b>ID:</b> ${id}<br><b>Status:</b> ${s.label}`);
            }
        });

        const tbody = document.getElementById('dataTable');
        scatterDataset.sort((a, b) => a.id.localeCompare(b.id)).forEach(p => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td class="${p.id.startsWith('COI') ? 'id-urban' : ''}">${p.id}</td>
                <td style="opacity:0.7">${p.lat.toFixed(4)}, ${p.lng.toFixed(4)}</td>
                <td><span class="status-badge ${p.style}">${p.label}</span></td>
            `;
        });

        document.getElementById('counter').innerText = `PONTOS CARREGADOS: ${scatterDataset.length}`;
    }

    generateData();
</script>
</body>
</html>
