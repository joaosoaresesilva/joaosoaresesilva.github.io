function update() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        
        // --- INÍCIO DA ALTERAÇÃO: Lógica de Afogamento Dinâmico ---
        // Simula a redução do desnível do açude conforme o caudal aumenta
        let saltoBase = 4.0; 
        let reducaoAfogamento = (apaQ / 350); 
        // O diferencial mínimo entre Montante e Jusante é de 0.30m em cheia total
        let diferencialReal = Math.max(0.3, saltoBase - reducaoAfogamento); 
        
        let hJusanteBase = apaH - diferencialReal;
        // --- FIM DA ALTERAÇÃO ---

        let mare = Math.sin(Date.now() / 3600000) * 0.8;
        
        document.getElementById('valFlow').innerText = apaQ.toFixed(0);
        document.getElementById('valCota').innerText = apaH.toFixed(2);
        document.getElementById('valMare').innerText = mare.toFixed(2);

        localidades.forEach(l => {
            let hFinal;
            if (l.reg === "A") {
                // Zona A: Mantém o nível de Montante
                hFinal = apaH + (apaQ / 5000);
            } else {
                // Zona B: Usa o novo hJusanteBase calculado com o afogamento do açude
                let pesoMare = Math.max(0, 1 - (l.dist / 50));
                hFinal = hJusanteBase - (l.dist * 0.08) + (apaQ / 2200) + (mare * 0.4 * pesoMare);
            }

            let diff = hFinal - l.cota;
            let statusClass = "status-seco";
            let statusText = "✓ SECO";

            if (diff >= 0) {
                statusClass = "status-alagado";
                statusText = "⚠️ CHEIA";
            } else if (diff >= -0.40) {
                statusClass = "status-provavel";
                statusText = "⚡ ALAGAMENTO PROVÁVEL";
            }

            let row = tbody.insertRow();
            let histPrefix = l.hist ? '<span class="historic-tag">H</span>' : '';
            
            row.insertCell(0).innerHTML = histPrefix + l.id;
            row.insertCell(1).innerText = l.cota.toFixed(1) + "m";
            row.insertCell(2).innerText = hFinal.toFixed(2) + "m";
            
            let cellStatus = row.insertCell(3);
            cellStatus.innerText = statusText;
            cellStatus.className = statusClass;

            let markerColor = "#ffffff";
            if(statusClass === "status-alagado") markerColor = "#ff0000";
            if(statusClass === "status-provavel") markerColor = "#ffa500";

            markers[l.id].setRadius(200 + (Math.max(0, diff + 0.5) * 600));
            markers[l.id].setStyle({color: markerColor, fillColor: markerColor});
            
            logData += `${Date.now()},${l.id},${hFinal.toFixed(2)},${statusText}\n`;
        });
    }
