<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>MONDEGO RADAR - PONTOS CRÍTICOS BAIXA</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: 'Courier New', monospace; background: #050505; color: #d0d0d0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #map { height: 45vh; width: 100%; background: #000; filter: grayscale(1) contrast(1.2) brightness(0.7); border-bottom: 2px solid #444; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { flex: 1; padding: 15px; background: #0a0a0a; border-right: 1px solid #333; overflow-y: auto; }
        .results { flex: 1; padding: 15px; background: #050505; overflow-y: auto; }
        .poi-card { background: #111; border: 1px solid #333; padding: 10px; margin-bottom: 8px; font-size: 11px; }
        .cota-tag { padding: 2px 5px; border-radius: 3px; font-weight: bold; float: right; }
        .c20 { background: #e74c3c; color: white; } /* Perigo imediato */
        .c21 { background: #f39c12; color: white; }
        .c22 { background: #f1c40f; color: black; }
        h2 { font-size: 14px; color: #00d2ff; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="main-container">
    <div class="sidebar">
        <h2>Radar de Cotas Críticas</h2>
        <p style="font-size: 10px;">Locais detetados no raio de 10km (Baixa Coimbra) com cotas entre 20m e 22m.</p>
        <div id="poiList"></div>
    </div>
    <div class="results">
        <h2>Monitorização em Tempo Real</h2>
        <div id="statusLive">Aguardando dados APA...</div>
        <table id="riskTable" style="width: 100%; font-size: 10px; margin-top: 10px;">
            <tr style="color: #888;"><td>LOCAL</td><td>COTA</td><td>DIST.</td><td>ESTADO</td></tr>
        </table>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([40.209, -8.431], 14);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    // Simulação de base de dados extraída via Google Elevation/Places
    const pontosCriticos = [
        {nome: "Mercado Municipal D. Pedro V", lat: 40.2115, lng: -8.4289, cota: 21.5},
        {nome: "Estação Coimbra-A (Comboios)", lat: 40.2111, lng: -8.4337, cota: 20.2},
        {nome: "Praça do Comércio", lat: 40.2092, lng: -8.4298, cota: 20.8},
        {nome: "Mosteiro Sta Clara-a-Velha", lat: 40.2018, lng: -8.4340, cota: 19.2},
        {nome: "Exploratório (Parque Verde)", lat: 40.1985, lng: -8.4315, cota: 21.0},
        {nome: "Hotel Astória", lat: 40.2088, lng: -8.4315, cota: 20.5},
        {nome: "Pavilhão Centro de Portugal", lat: 40.2035, lng: -8.4285, cota: 20.1},
        {nome: "Edifício da CM Coimbra", lat: 40.2120, lng: -8.4295, cota: 22.0}
    ];

    pontosCriticos.forEach(p => {
        let color = p.cota <= 20.5 ? '#e74c3c' : (p.cota <= 21.5 ? '#f39c12' : '#f1c40f');
        L.circleMarker([p.lat, p.lng], {radius: 6, color: color, fillOpacity: 0.8}).addTo(map)
         .bindPopup(`<b>${p.nome}</b><br>Cota: ${p.cota}m`);

        const div = document.createElement('div');
        div.className = 'poi-card';
        let cotaClass = p.cota <= 20.5 ? 'c20' : (p.cota <= 21.5 ? 'c21' : 'c22');
        div.innerHTML = `<span class="cota-tag ${cotaClass}">${p.cota}m</span>
                         <b>${p.nome}</b><br>
                         Lat: ${p.lat}, Lng: ${p.lng}`;
        document.getElementById('poiList').appendChild(div);
    });

</script>
</body>
</html>
