<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Inundação Gradual - Coimbra</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 600px; width: 100%; border-radius: 8px; background: #aad3df; }
        .controls { 
            padding: 20px; 
            background: #ffffff; 
            margin-bottom: 10px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-family: sans-serif;
        }
        .status { font-weight: bold; margin-top: 10px; min-height: 20px; }
        input { padding: 5px; width: 60px; }
        button { padding: 5px 15px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>

<div class="controls">
    <h2>Simulador de Cheias - Mondego (Gradiente)</h2>
    <label for="waterLevel">Nível do Rio (metros): </label>
    <input type="number" id="waterLevel" value="15" step="0.5">
    <button onclick="updateSimulation()">Simular Impacto</button>
    <p id="alertMsg" class="status"></p>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([40.2085, -8.4285], 15);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap'
    }).addTo(map);

    // Criamos camadas de círculos para simular o "espalhamento" da água
    // As coordenadas focam na zona da Baixa e Parque Verde
    const zonaBaixa = L.circle([40.2100, -8.4300], {
        color: 'transparent',
        fillColor: 'blue',
        fillOpacity: 0,
        radius: 100
    }).addTo(map);

    const zonaParque = L.circle([40.2045, -8.4275], {
        color: 'transparent',
        fillColor: 'cyan',
        fillOpacity: 0,
        radius: 100
    }).addTo(map);

    function getGradientColor(level) {
        // Retorna uma cor baseada na severidade (Azul -> Laranja -> Vermelho)
        if (level >= 20) return '#ff0000'; // Perigo Crítico
        if (level >= 18) return '#ff8c00'; // Alerta Médio
        return '#0074D9';                // Nível Inicial
    }

    function updateSimulation() {
        const level = parseFloat(document.getElementById('waterLevel').value);
        const msg = document.getElementById('alertMsg');
        
        // Reset visual
        zonaBaixa.setStyle({fillOpacity: 0, radius: 0});
        zonaParque.setStyle({fillOpacity: 0, radius: 0});

        if (level >= 17) {
            // Parque Verde começa a inundar
            let intensity = Math.min((level - 16) * 0.2, 0.7);
            let radius = (level - 16) * 150;
            
            zonaParque.setStyle({
                fillColor: getGradientColor(level),
                fillOpacity: intensity,
                radius: radius
            });
            msg.innerText = "O Parque Verde está a ser afetado.";
            msg.style.color = "blue";
        }

        if (level >= 18.5) {
            // Baixa de Coimbra começa a ser afetada
            let intensity = Math.min((level - 18) * 0.25, 0.8);
            let radius = (level - 18) * 250;

            zonaBaixa.setStyle({
                fillColor: getGradientColor(level),
                fillOpacity: intensity,
                radius: radius
            });
            msg.innerText = "AVISO: A água está a chegar às ruas da Baixa!";
            msg.style.color = "orange";
        }

        if (level >= 20) {
            msg.innerText = "ALERTA CRÍTICO: Inundação severa em curso!";
            msg.style.color = "red";
        }

        if (level < 17) {
            msg.innerText = "Nível dentro da normalidade.";
            msg.style.color = "green";
        }
    }
</script>

</body>
</html>
