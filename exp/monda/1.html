<script>
    const map = L.map('map').setView([40.2085, -8.4285], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);

    // Definição das zonas em ambas as margens
    const zonas = {
        parque: { 
            nome: "Parque Verde / Docas",
            circle: L.circle([40.2045, -8.4275], { color: 'none', fillColor: '#00ced1', fillOpacity: 0, radius: 0 }).addTo(map),
            threshold: 16.0, 
            maxRadius: 450
        },
        baixa: { 
            nome: "Baixa de Coimbra",
            circle: L.circle([40.2105, -8.4300], { color: 'none', fillColor: '#e74c3c', fillOpacity: 0, radius: 0 }).addTo(map),
            threshold: 18.5,
            maxRadius: 550
        },
        margemEsquerda: { 
            nome: "Santa Clara / Portugal dos Pequenitos",
            // Coordenadas da margem oposta à Baixa
            circle: L.circle([40.2040, -8.4315], { color: 'none', fillColor: '#f39c12', fillOpacity: 0, radius: 0 }).addTo(map),
            threshold: 16.8, // Inunda logo após o Parque Verde
            maxRadius: 500
        }
    };

    let waterLevel = 15.0;
    let time = 0;
    let timer = null;

    // ... (restante lógica de inputs e botões igual ao anterior) ...

    function updateMap() {
        document.getElementById('levelDisplay').innerText = waterLevel.toFixed(2);
        document.getElementById('timeDisplay').innerText = time;

        let alertas = [];

        for (let z in zonas) {
            let zona = zonas[z];
            if (waterLevel > zona.threshold) {
                let diff = waterLevel - zona.threshold;
                let newRadius = Math.min(diff * 180, zona.maxRadius);
                let newOpacity = Math.min(diff * 0.25, 0.7);
                
                zona.circle.setRadius(newRadius);
                zona.circle.setStyle({ fillOpacity: newOpacity });
                
                if (diff > 0.5) alertas.push(zona.nome);
            } else {
                zona.circle.setRadius(0);
            }
        }

        // Gestão de Mensagens de Alerta
        const msgBox = document.getElementById('alertMsg');
        if (alertas.length > 0) {
            msgBox.innerText = "ZONAS AFETADAS: " + alertas.join(" | ");
            msgBox.style.color = (waterLevel > 19) ? "#ff4757" : "#ffa502";
        } else {
            msgBox.innerText = "Caudal controlado. Margens seguras.";
            msgBox.style.color = "#2ecc71";
        }
    }

    // Lógica do Timer e Reset mantêm-se iguais
    // ...
</script>
