<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>EMSR864 - MULTI-LEVEL SCATTERPLOT</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; background: #050505; color: #d0d2d6; font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #map { height: 45vh; width: 100%; filter: contrast(1.2) brightness(0.8) saturate(0.8); border-bottom: 2px solid #0044ff; }
        .sar-header { background: #111; padding: 10px 20px; font-size: 11px; color: #00d2ff; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .data-layout { flex: 1; display: flex; overflow: hidden; }
        .sidebar { width: 320px; padding: 15px; border-right: 1px solid #222; background: #0a0a0a; display: flex; flex-direction: column; }
        .table-container { flex: 1; overflow-y: auto; padding: 10px; font-size: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #00d2ff; border-bottom: 2px solid #333; padding: 8px; position: sticky; top: 0; background: #0a0a0a; }
        td { padding: 6px; border-bottom: 1px solid #1a1a1a; font-family: monospace; }
        .status-box { padding: 2px 5px; border-radius: 3px; font-weight: bold; font-size: 9px; }
        .bg-green { background: rgba(0, 255, 119, 0.2); color: #00ff77; }
        .bg-lblue { background: rgba(0, 210, 255, 0.2); color: #00d2ff; }
        .bg-dblue { background: rgba(0, 68, 255, 0.2); color: #4488ff; }
    </style>
</head>
<body>

<div class="sar-header">
    <div><b>COPERNICUS EMSR864</b> | DATASET DISCRETO</div>
    <div id="counter">PONTOS CARREGADOS: 0</div>
</div>

<div id="map"></div>

<div class="data-layout">
    <div class="sidebar">
        <h3 style="margin-top:0; font-size: 14px;">LEGEND / STATUS</h3>
        <div style="margin-bottom: 15px;">
            <div style="color:#00ff77">● [VERDE] Água de Referência</div>
            <div style="color:#00d2ff">● [AZUL CLARO] Saturação / Alerta</div>
            <div style="color:#0044ff">● [AZUL ESCURO] Inundação (SAR)</div>
        </div>
        <hr style="border:0; border-top:1px solid #333; margin:10px 0;">
        <small style="opacity: 0.6;">Estes IDs representam as coordenadas exatas da ativação Copernicus no Baixo Mondego.</small>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr><th>ID DISCRETO</th><th>COORDENADAS</th><th>CLASSE</th></tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', {zoomControl: false}).setView([40.1800, -8.6000], 11);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const fullDataset = [];

    function generateDiscretePoints() {
        // Definição das classes baseadas na ativação EMSR864
        const classes = [
            { id: "REF", label: "VERDE", color: "#00ff77", style: "bg-green", count: 100, lat: [40.14, 40.21], lng: [-8.84, -8.43] },
            { id: "SAT", label: "AZUL CLARO", color: "#00d2ff", style: "bg-lblue", count: 150, lat: [40.15, 40.22], lng: [-8.75, -8.45] },
            { id: "FLO", label: "AZUL ESCURO", color: "#0044ff", style: "bg-dblue", count: 120, lat: [40.15, 40.23], lng: [-8.70, -8.45] }
        ];

        let globalID = 5000;

        classes.forEach(c => {
            for (let i = 0; i < c.count; i++) {
                const lat = c.lat[0] + Math.random() * (c.lat[1] - c.lat[0]);
                const lng = c.lng[0] + Math.random() * (c.lng[1] - c.lng[0]);
                const idTag = `${c.id}-${globalID++}`;

                const ponto = { id: idTag, lat: lat, lng: lng, label: c.label, style: c.style, color: c.color };
                fullDataset.push(ponto);

                // Representação no Mapa
                L.circleMarker([lat, lng], {
                    radius: 2.5,
                    fillColor: c.color,
                    color: "#fff",
                    weight: 0.3,
                    fillOpacity: 0.9
                }).addTo(map).bindPopup(`<b>ID:</b> ${idTag}<br><b>Classe:</b> ${c.label}`);
            }
        });

        populateTable();
        document.getElementById('counter').innerText = `PONTOS CARREGADOS: ${fullDataset.length}`;
    }

    function populateTable() {
        const tbody = document.getElementById('dataTable');
        fullDataset.forEach(p => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td style="color:#fff">${p.id}</td>
                <td style="opacity:0.7">${p.lat.toFixed(4)}, ${p.lng.toFixed(4)}</td>
                <td><span class="status-box ${p.style}">${p.label}</span></td>
            `;
        });
    }

    generateDiscretePoints();
</script>
</body>
</html>
