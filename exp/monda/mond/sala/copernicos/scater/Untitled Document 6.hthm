<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>MONDEGO MONITOR - INFRAESTRUTURA CRÍTICA</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; background: #050505; color: #00d2ff; font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #map { height: 50vh; width: 100%; filter: contrast(1.2) brightness(0.8); border-bottom: 2px solid #0044ff; }
        .data-panel { flex: 1; display: flex; background: #0a0a0a; overflow: hidden; }
        .alert-list { width: 350px; padding: 15px; border-right: 1px solid #222; overflow-y: auto; }
        .status-card { background: #111; border: 1px solid #333; padding: 10px; margin-bottom: 8px; font-size: 11px; }
        .flood-active { border-left: 4px solid #ff4444; color: #fff; }
        .flood-safe { border-left: 4px solid #00ff77; opacity: 0.6; }
        .val { font-weight: bold; color: #00d2ff; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="data-panel">
    <div class="alert-list">
        <h3 style="margin-top:0; font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 5px;">ESTADO DE INFRAESTRUTURA</h3>
        <div id="infraList"></div>
    </div>
    <div style="flex:1; padding: 20px;">
        <small>NÍVEL DO RIO (AÇUDE)</small>
        <div id="rioNivel" style="font-size: 32px; font-weight: bold;">---</div>
        <p style="font-size: 12px; opacity: 0.5; margin-top: 20px;">
            Sistema de monitorização baseado em pixéis SAR do Copernicus EMSR864 aplicados a coordenadas GPS reais de Coimbra.
        </p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', {zoomControl: false}).setView([40.2050, -8.4330], 15);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    const infraestrutura = [
        {id: "MOSTEIRO STA CLARA", pos: [40.2018, -8.4340], cota: 18.2, reg: "C"},
        {id: "PARQUE VERDE - SUL", pos: [40.2035, -8.4285], cota: 18.8, reg: "C"},
        {id: "ESTÁDIO UNIVERSITÁRIO", pos: [40.2065, -8.4385], cota: 19.1, reg: "C"},
        {id: "EXPLORATÓRIO", pos: [40.2005, -8.4315], cota: 19.5, reg: "C"},
        {id: "DOCAS - PARQUE", pos: [40.2078, -8.4312], cota: 18.6, reg: "C"},
        {id: "PORTARIA AÇUDE", pos: [40.2112, -8.4375], cota: 19.8, reg: "C"},
        {id: "ESTAÇÃO COIMBRA-B", pos: [40.2195, -8.4410], cota: 21.5, reg: "C"}
    ];

    // Criar Markers no Mapa
    infraestrutura.forEach(loc => {
        loc.marker = L.circleMarker(loc.pos, {
            radius: 6,
            weight: 2,
            color: "#fff",
            fillOpacity: 1
        }).addTo(map).bindPopup(loc.id);
    });

    function engine() {
        // Simulação de caudal dinâmico
        const Q = 900 + (Math.sin(Date.now()/5000) * 400);
        const hAgua = 19.2 + (Q / 1800);
        
        document.getElementById('rioNivel').innerText = hAgua.toFixed(2) + " m";
        const listDiv = document.getElementById('infraList');
        listDiv.innerHTML = '';

        infraestrutura.forEach(loc => {
            const isFlooded = hAgua > loc.cota;
            const statusClass = isFlooded ? 'flood-active' : 'flood-safe';
            const color = isFlooded ? '#0044ff' : '#00ff77';

            loc.marker.setStyle({ fillColor: color });

            listDiv.innerHTML += `
                <div class="status-card ${statusClass}">
                    <b>${loc.id}</b><br>
                    Cota Solo: ${loc.cota}m | Status: <span class="val">${isFlooded ? 'SUBMERSO' : 'SECO'}</span>
                </div>
            `;
        });
    }

    setInterval(engine, 3000);
    engine();
</script>
</body>
</html>
